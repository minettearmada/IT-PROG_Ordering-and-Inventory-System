<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script>
        const name = document.getElementById('customer').value;
        const main = document.getElementById('product1').value;
        const side = document.getElementById('product2').value;
        
        const drink = document.getElementById('product3').value;
        const m1 = document.getElementById('quantity1').value;
        const s1 = document.getElementById('quantity2').value;
        const d1 = document.getElementById('quantity3').value;
        const CMT = 0;
        const SVB = 0;
        const final = document.getElementById('totalDiscounted').value;

        

    </script>

</head>
<body>
    <form method="post" action="/payment">
        <table>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
            </tr>
            <tr>
              <% for (let i = 0; i < listProduct.length; i++) { %>
                  <tr>
                      <td><%- listProduct[i] %></td>
                      <td><%- listPrice[i] %></td>
                      <td><%- listQuantity[i] %></td>
                      <input type="hidden" name="product<%-i%>" id="product<%-i%>" value="<%- listProduct[i] %>">
                      <input type="hidden" name="price<%-i%>" id="price<%-i%>" value="<%- listPrice[i] %>">
                      <input type="hidden" name="quantity<%-i%>" id="quantity<%-i%>" value="<%- listQuantity[i] %>">
                  </tr>
              <% } %>
              <!-- <th class="productList" id="productList"></th> -->
            </tr>
            <tr>
              <th class="total" id="total"></th>
              <!-- gets the last value of the array for the final total amount -->
              <input type="hidden" value="<%- total[total.length - 1] %>" name="total">
              <th class="totalDiscounted" id="totalDiscounted"></th>
              <input type="hidden" value="<%- totalDiscounted %>" id="totalDiscounted" name="totalDiscounted">
              </th>
            </tr>
            <tr>
              <td>Name:</td>
              <td> <input type="text" name="customer" id="customer" size="25" required></td> 
            </tr> 
            <tr>
                <td>Cash Amount:</td> 
                <td> <input type="number" name="cash" id="cash" required></td> 
              </tr> 
          </table>	  
    
        <input type="submit" id="button" name="save" /><br />
    </form>
    <script>

        const productList = JSON.parse('<%- JSON.stringify(listProduct) %>');
        const priceList = JSON.parse('<%- JSON.stringify(listPrice) %>');
        const quantityList = JSON.parse('<%- JSON.stringify(listQuantity) %>');
        const total = JSON.parse('<%- JSON.stringify(total[total.length - 1]) %>');

        function execute(event){
            console.log("WORKING");
            event.preventDefault();

        
        //event.preventDefault();

        /*
        fetch('/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(temp)
        })
        .then(response => {
            if(response.ok){
                console.log('Order created successfully!')

                alert('Payment Successful!');
                window.location.href = "/";
            }else{
                console.error('Failed to create order');
                alert('Payment Failed!');
            }
        })
        .catch(error => {
            console.error('An error occurred:', error);
            alert('Payment Failed!');
        });

        */
        //return true;
        }    



        let productListHTML = '';
        let totalDiscounted = total;

        document.addEventListener('DOMContentLoaded', () => {
            // Display total
            const totalElement = document.getElementById('total');
            totalElement.innerText = `Total: ${total}`;

            // Set total and totalDiscounted form inputs
            const totalInput = document.getElementById('totalInput');
            totalInput.value = total;

            const totalDiscountedInput = document.getElementById('totalDiscountedInput');
            totalDiscountedInput.value = totalDiscounted.toFixed(2); // Add this line

            // Set totalDiscounted element
            const totalDiscountedElement = document.getElementById('totalDiscounted');
            totalDiscountedElement.innerText = `Discounted Total: ${totalDiscounted.toFixed(2)}`;

            const button = document.getElementById('button');
            button.addEventListener('click', execute());
        });


        const chickenIndex = productList.indexOf('CHICKEN');
        const mashedPotatoIndex = productList.indexOf('MASHED POTATO');
        const icedTeaIndex = productList.indexOf('ICED TEA');

        if (chickenIndex !== -1 && mashedPotatoIndex !== -1 && icedTeaIndex !== -1) {
            totalDiscounted -= totalDiscounted * 0.1;

            totalDiscounted = parseFloat(totalDiscounted);
            totalDiscountedHTML = `Discounted Total: ${totalDiscounted.toFixed(2)}`;

            const totalDiscountedElement = document.getElementById('totalDiscounted');
            totalDiscountedElement.innerText = totalDiscountedHTML;

            alert('Chicken Mash Tea Combo! 10% Discount is applied!');
        }

        const steakIndex = productList.indexOf('STEAK');
        const steamedVegetablesIndex = productList.indexOf('STEAMED VEGETABLES');
        const rootBeerIndex = productList.indexOf('ROOT BEER');

        if (steakIndex !== -1 && steamedVegetablesIndex !== -1 && rootBeerIndex !== -1) {
            totalDiscounted -= totalDiscounted * 0.15;
            totalDiscounted = parseFloat(totalDiscounted);
            totalDiscountedHTML = `Discounted Total: ${totalDiscounted.toFixed(2)}`;

            const totalDiscountedElement = document.getElementById('totalDiscounted');
            totalDiscountedElement.innerText = totalDiscountedHTML;

            alert('Steak Veg Beer Combo! 15% Discount is applied!')
        }



        const temp = {
            name : name,
            main : main,
            side : side,
            drink : drink,
            m1 : m1,
            s1 : s1,
            d1 : d1,
            CMT : CMT,
            SVB : SVB,
            final : final
        };


        //document.getElementById("button").onsubmit = function(event){
        
        

        function test(event){
            console.log("WORKING");
        }




    </script>
</body>
</html>